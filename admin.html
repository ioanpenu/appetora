<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Appetora Admin</title><script src="https://cdn.tailwindcss.com"></script></head>
<body class="bg-slate-50 text-slate-900 p-6">
  <div class="max-w-3xl mx-auto grid gap-4">
    <h1 class="text-2xl font-bold">Admin dashboard</h1>
    <div class="flex gap-2">
      <input id="admin-pass" type="password" placeholder="Admin password" class="border rounded px-3 py-2">
      <button id="btn-admin-login" class="px-3 py-2 rounded bg-orange-500 text-white">Login</button>
    </div>
    <div class="flex gap-2 items-center">
      <input id="day" type="date" class="border rounded px-3 py-2">
      <button id="btn-load" class="px-3 py-2 rounded bg-slate-100 border">Load</button>
    </div>
    <div id="out" class="text-sm text-slate-700"></div>
    <table class="min-w-full text-sm">
      <thead><tr class="text-left text-slate-600"><th class="py-2 pr-4">User</th><th class="py-2 pr-4">Calls</th><th class="py-2 pr-4">Input tok</th><th class="py-2 pr-4">Output tok</th><th class="py-2 pr-4">Cost (USD)</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
<script>
let adminToken=null;
document.getElementById('btn-admin-login').onclick=async()=>{
  const p=document.getElementById('admin-pass').value;
  const r=await fetch('/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:p})});
  const j=await r.json();
  if(!r.ok){ alert(j.error||'Login failed'); return; }
  adminToken=j.token; alert('Admin logged in');
};
document.getElementById('btn-load').onclick=async()=>{
  const day=document.getElementById('day').value;
  if(!adminToken){ alert('Login first'); return; }
  const r=await fetch('/api/admin/metrics?date='+encodeURIComponent(day),{headers:{'Authorization':'Bearer '+adminToken}});
  const j=await r.json();
  if(!r.ok){ alert(j.error||'Error'); return; }
  document.getElementById('out').textContent = `Total: $${(j.total_cost||0).toFixed(4)} â€¢ Calls: ${j.total_calls||0}`;
  const tb=document.getElementById('rows'); tb.innerHTML='';
  (j.items||[]).forEach(it=>{
    const tr=document.createElement('tr'); tr.className='border-t';
    tr.innerHTML = `<td class="py-2 pr-4">${it.user||'(unknown)'}</td><td class="py-2 pr-4">${it.calls||0}</td><td class="py-2 pr-4">${it.input_tokens||0}</td><td class="py-2 pr-4">${it.output_tokens||0}</td><td class="py-2 pr-4">$${(it.cost_usd||0).toFixed(4)}</td>`;
    tb.appendChild(tr);
  });
};
</script>
</body></html>
